---
title: "Clú de R"
author: "Sergio García Mora"
date: "30/3/2020"
output: html_document
---

```{r}
# s <- livecode::serve_file()
```

# Sesión 1 del Clú de R

Estos son ejercicios tomados del libro **Ciencia de datos para gente sociable** que escribió <Antonio Vazquez Brust>[Antonio Vazquez Brust](https://www.linkedin.com/in/avazquez/?originalSubdomain=ar) y que se puede leer gratis en la <web del libro>[web del libro](https://bitsandbricks.github.io/ciencia_de_datos_gente_sociable/) y encontrar en su <blog personal>[blog personal](https://bitsandbricks.github.io/).

Elegimos este libro primero porque está en español, y segundo porque para introducir el lenguaje R comienza con un ejemplo muy entrenido y cercano, mucho más comprensible que los clásicos datasets *iris* o *mtcars*.

# Empezando

Para instalar paquetes en R

*install.packages("ggplot2")*

Luego, se carga el paquete para poder usarlo
```{r}
library(ggplot2)
```

Con el símbolo **"<-"** (como una flecha hacia la izquierda) se asignan cosas a los objetos. Luego ejecuto el nombre con las teclas Ctrl+Enter y veo el resultado de lo que asigné.

```{r echo=TRUE}
tipico <- "Hola Mundo"
tipico
```

También se puede usar el signo igual, aunque puede confundir después cuando tipeamos código
```{r echo = TRUE}
tipica = "Hola Mundo"

tipica
```
 
Dos signos iguales se usan para analizar si dos cosas son iguales
```{r echo=TRUE}
tipico == tipica
```
Para más información, ver los operadores relacionales en este <link>[link](https://bookdown.org/jboscomendoza/r-principiantes4/operadores-relacionales.html).

Se usa el numeral o hashtag (#) para hacer comentarios 

*#library(tidyverse)*


# Libro Ciencia de Datos Capítulo 2 

Cargo los datos que vamos a usar de esta url y lo asigno al objeto mortalidad

```{r echo=TRUE}
mortalidad <- read.csv('https://bitsandbricks.github.io/data/mortalidad_infantil_caba_2016.csv')
```

A partir de ahora, cada vez necesite estos datos, sólo invoco el nombre del objeto
```{r echo=TRUE}
mortalidad
```


Funciones para explorar datasets
```{r echo=TRUE}
dim(mortalidad) # De dimensión, nos dice la cantidad de columnas y de filas
names(mortalidad) # Nos da los nombres de las variables, muy útil cuando tenemos muchas columnas
head(mortalidad) # Te muestra las primeras 6 filas
tail(mortalidad) # Te muestra las últimas 6 filas
head(mortalidad, 10) # Tanto con head() como con tail() puedo indicar la cantidad de columnas que quiero ver

library(tidyverse)
glimpse(mortalidad) # Indica la cantidad de observaciones, variables, los nombres de columnas, tipo de variables, y una muestra de los primeros registros
```

La función **summary** nos da las principales medidas estadísticas de las variables numéricas

* Min y Max (Mínimo y Máximo valor)
* 1st y 3rd Qu. (Primer y tercer cuartil)
* Mean y Median (Promedio y mediana)

```{r echo = TRUE}
summary(mortalidad)
```


## Nuestro primer gráfico con el paquete ggplot2 (Grammar of graphics plot)

```{r echo = TRUE}
ggplot(mortalidad, aes(x = factor(Comuna), y = Tasa2016)) +
  geom_col()
```

¿Qué pasa si no uso la función factor()
```{r echo = TRUE}
ggplot(mortalidad, aes(x = Comuna, y = Tasa2016)) +
  geom_col()
```

# Análisis geográfico

Carguemos la librería *sf* para análisis espaciales.
```{r echo = TRUE}
library(sf)
```

Cargo un dataset con información geográfica de los barrios y comunas de la Ciudad Autónoma de Buenos Aires
```{r echo = TRUE}
comunas <- st_read('https://bitsandbricks.github.io/data/CABA_comunas.geojson')
```

Exploro el dataset
```{r echo = TRUE}
names(comunas)
head(comunas)
```

Hago un gráfico para ver la Ciudad Autónoma de Buenos Aires
```{r echo = TRUE}
ggplot(comunas) +
  geom_sf()
```

Le asigno un color por Comuna
```{r echo = TRUE}
ggplot(comunas) +
  geom_sf(aes(fill = comunas))
```

Agrega Av. Rivadavia que divide a la ciudad en 2
```{r echo = TRUE}
rivadavia <- st_read('https://bitsandbricks.github.io/data/avenida_rivadavia.geojson')
```

Combino los gráficos de Comuna, incluyendo a la Av. Rivadavia 
```{r echo = TRUE}
ggplot(comunas) +
  geom_sf(aes(fill = comunas)) +
  geom_sf(data = rivadavia, color = "red")
```

## Agregar nueva columna

Creamos un vector con la región a la que pertenece cada comuna
```{r echo = TRUE}
nueva_columna <- c("Sur", "Norte", "Sur", "Sur", "Sur", "Norte", "Sur", "Sur", 
                   "Sur", "Norte", "Norte", "Norte", "Norte", "Norte", "Norte")
```

La función mutate agrega columnas
```{r echo = TRUE}
comunas <- mutate(comunas, ubicacion = nueva_columna) # "ubicacion" es el nombre de la columna nueva
```

Acá podemos ver que la columna ubicacion se añadió al final de la tabla comunas
```{r echo = TRUE}
glimpse(comunas)
```

Ahora actualizamos el mapa, coloreando las comunas del Sur y del Norte
```{r echo = TRUE}
ggplot(comunas) +
  geom_sf(aes(fill = ubicacion)) + 
  geom_sf(data = rivadavia, color = "red")
```

Agregamos a la tabla de mortalidad la ubicación

```{r echo = TRUE}
mortalidad <- mutate(mortalidad, ubicación = nueva_columna)

head(mortalidad)
```

# Analizar la mortalidad por zona de la ciudad

Graficamos para analizar la mortalidad infantil por Comuna
```{r echo = TRUE}
ggplot(comunas) +
  geom_sf(aes(fill = mortalidad$Tasa2016)) + # Con el símbolo $ se elige la columna específica a graficar
  geom_sf(data = rivadavia, color = "red") +
  scale_fill_distiller(palette = "Spectral")
```

Si bien los mapas son llamativos, a veces los gráficos de barra son más claros
```{r echo = TRUE}
ggplot(mortalidad) +
  geom_col(aes(x = Comuna, y = Tasa2016, fill = ubicación)) +
  labs(title = "Mortalidad infantil en la Ciudad Autónoma de Buenos Aires", # con esta función le agregamos un título al gráfico
       subtitle = "Año 2016",
       y = "tasa") 
```

Dividimos los datos por zona
```{r echo = TRUE}
comunas_al_sur <- filter(mortalidad, ubicación == "Sur")

comunas_al_norte <- filter(mortalidad, ubicación == "Norte")
```

Calculamos la diferencia entre el promedio de mortalidad de unas y otras.
```{r echo = TRUE}
mean(comunas_al_sur$Tasa2016) / mean(comunas_al_norte$Tasa2016)
```

# Ejercicios Capítulo 2
Descargué datos de la página del Banco Mundial de este link [link](https://databank.bancomundial.org/source/gender-statistics/preview/on#) en formato csv.

Luego uso un paquete para leer archivos (también podría usarlo para leer archivos Excel)
```{r echo = TRUE}
library(readr)
```

Para levantar un archivo hay dos opciones:

* Especificar toda la ubicación
```{r echo = TRUE}
participacion <- read_csv("C:/Users/Usuario/Documents/R/Clu_de_R/Ratio_Participacion_Laboral_Femenina.csv")
```

* Pero si el archivo lo guardamos en la carpeta del proyecto solo ponemos el nombre del archivo
```{r echo = TRUE}
part_fem <- read_csv("Ratio_Participacion_Laboral_Femenina.csv")
```

El ejercicio nos pide relevar algunos datos del dataset
```{r echo = TRUE}
dim(part_fem)
names(part_fem)
glimpse(part_fem)
```
Cuando ejecutamos glimpse vemos que datos numéricos aparecen como *chr*, ¿qué pasa si ejecutamos la función summary?

```{r echo = TRUE}
summary(part_fem)
```

Una forma posible de solucionarlo
```{r echo = TRUE}
part_fem$`2019 [YR2019]` <- as.numeric(part_fem$`2019 [YR2019]`)
glimpse(part_fem)

head(part_fem)
```